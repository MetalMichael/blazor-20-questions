@using Microsoft.AspNetCore.Blazor.Services
@using Blazor20Questions.Client.Services
@using Blazor20Questions.Shared

@inject HttpClient Http
@inject IUriHelper UriHelper
@inject ModalService ModalService

<div class="simple-form">
    <div class="form-group">
        <label for="first-name">Please enter what you are thinking of...</label>
        <input bind="@Subject" type="text" class="form-control" id="first-name" placeholder="Enter email" />
    </div>
    <button onclick="@SubmitForm" class="btn btn-primary">Submit</button>

    @if (isError)
    {
        <div class="error">@error</div>
    }
</div>

@functions {
    string Subject { get; set; }

    bool isError;
    string error;

    async Task SubmitForm()
    {
        try
        {
            isError = false;
            var game = await Http.PostJsonAsync<GameResponse>("api/Game/Create", new { subject = Subject });
            UriHelper.NavigateTo($"/game/{game.Id}");
            ModalService.Close();
        }
        catch (Exception e)
        {
            System.Console.WriteLine("Error: " + e.ToString());
            isError = true;
            error = "An unexpected error occurred";
        }
    }
}